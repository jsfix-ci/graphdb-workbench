<link href="css/clustermanagement.css?v=[AIV]{version}[/AIV]" rel="stylesheet"/>

<div id="wb-cluster-group">
    <h1>{{pageTitle}}</h1>
    <div onto-loader-new ng-if="loader" class="cluster-loader" message="getLoaderMessage" size="75"></div>

    <div class="ng-scope" ng-if="editClusterGroup">
        <p class="alert alert-danger">
            Editing of cluster group is not implemented.
        </p>
    </div>

    <div ng-hide="editClusterGroup">
        <form id="cluster-group-form" class="form-horizontal" name="clusterGroupForm" novalidate="novalidate">
            <fieldset>
                <div class="row">
                    <div class="col-md-6 col-lg-6">
                        <!-- Simply to satisfy the HTML specs, because it's reported as bug from SonarCloud -->
                        <legend style="display: none">Cluster group properties</legend>
                        <div class="form-group row">
                            <label for="election-minimum-timeout" class="col-lg-6 col-xl-5 col-form-label">Election Minimum Timeout*</label>
                            <div class="col-lg-6 col-xl-7" tooltip="{{clusterTooltips.electionMinTimeout}}">
                                <input class="form-control" placeholder="This field is required" type="number" ng-model="clusterGroup.electionMinTimeout"
                                       required id="election-minimum-timeout">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="election-range-timeout" class="col-lg-6 col-xl-5 col-form-label">Election Range Timeout*</label>
                            <div class="col-lg-6 col-xl-7" tooltip="{{clusterTooltips.electionRangeTimeout}}">
                                <input class="form-control" placeholder="This field is required" type="number" ng-model="clusterGroup.electionRangeTimeout"
                                       required id="election-range-timeout">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="heartbeat-interval" class="col-lg-6 col-xl-5 col-form-label">Heartbeat Interval*</label>
                            <div class="col-lg-6 col-xl-7" tooltip="{{clusterTooltips.heartbeatInterval}}">
                                <input class="form-control" placeholder="This field is required" type="number" ng-model="clusterGroup.heartbeatInterval"
                                       required id="heartbeat-interval">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="message-size" class="col-lg-6 col-xl-5 col-form-label">Message Size KB*</label>
                            <div class="col-lg-6 col-xl-7" tooltip="{{clusterTooltips.messageSizeKB}}">
                                <input class="form-control" placeholder="This field is required" type="number" ng-model="clusterGroup.messageSizeKB"
                                       required id="message-size">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="verification-timeout" class="col-lg-6 col-xl-5 col-form-label">Verification Timeout*</label>
                            <div class="col-lg-6 col-xl-7" tooltip="{{clusterTooltips.verificationTimeout}}">
                                <input class="form-control" placeholder="This field is required" type="number" ng-model="clusterGroup.verificationTimeout"
                                       required id="verification-timeout">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-lg-4">
                        <h4>Nodes</h4>
                        <div class="form-group row">
                            <label for="node-rpc-address" class="col-lg-5 col-xl-5 col-form-label">Node RPC address</label>
                            <div class="col-lg-7 col-xl-7" tooltip="{{clusterTooltips.nodeRpcAddress}}">
                                <input class="form-control" placeholder="Enter node address" type="text" ng-model="rpcAddress" id="node-rpc-address">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <button type="button" class="btn btn-primary addNodeBtn"
                                        ng-click="addNodeToList(rpcAddress)" ng-disabled="!rpcAddress"
                                        tooltip="Add node to cluster group" tooltip-placement="top">
                                    <span class="icon-plus"></span> Add node
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div ng-if="clusterGroup.nodes.length < 2" class="notEnoughNodesError alert alert-danger mt-1">
                                    Must have at least two nodes
                                </div>
                                <div ng-if="clusterGroup.nodes.includes(rpcAddress)" class="nodeAlreadyAdded alert alert-danger mt-1">
                                    Node is already in the list
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 mb-1 mt-1">
                                <ul ng-if="clusterGroup.nodes && clusterGroup.nodes.length" class="list-group nodesList">
                                    <li ng-repeat="node in clusterGroup.nodes" class="list-group-item d-flex justify-content-between align-items-center node">
                                        <div>
                                            <span class="icon-repo-graphdb icon-2-5x"></span>
                                            {{node}}
                                        </div>
                                        <button type="button" ng-click="removeNodeToList($index)"
                                                tooltip="Remove node from cluster group" tooltip-placement="top"
                                                class="btn btn-link removeNodeBtn">
                                            <span class="icon-minus"></span>
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div ng-repeat="error in errors" class="clusterPropertiesError alert alert-danger mt-1">
                    {{error}}
                </div>
                <div ng-if="preconditionErrors" class="preconditionErrors alert alert-danger">
                    <div class="row">
                        <div class="col-xs-6">
                            Some of the preconditions for creating a cluster group are not met!
                            <ul>
                                <li>Nodes must have a valid enterprise license</li>
                                <li>Authentication secret must be set on all nodes</li>
                                <li>Nodes must be online</li>
                                <li>Nodes must not have cluster configuration</li>
                            </ul>
                        </div>
                        <div class="col-xs-6">
                            Nodes status
                            <ul>
                                <li ng-repeat="error in preconditionErrors">
                                    {{error}}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="form-group row pb-3">
                    <div class="col-xs-12">
                        <button ng-if="!editClusterGroup"  id="createClusterGroup" ng-click="createClusterGroup(clusterGroupForm)" type="submit"
                                class="btn btn-primary createClusterGroupBtn" ng-disabled="!clusterGroup.nodes || clusterGroup.nodes.length < 2">Create
                        </button>
                        <button ng-if="editClusterGroup" id="editClusterGroup" ng-click="editRepository()" type="submit"
                                class="btn btn-primary editClusterGroupBtn" ng-disabled="!clusterGroup.nodes || clusterGroup.nodes.length < 2">Save
                        </button>
                        <a ng-click="goToClusterManagementPage()" class="btn btn-secondary cancelEditClusterGroupBtn">Cancel</a>
                    </div>
                </div>
            </fieldset>
        </form>
    </div>
</div>
